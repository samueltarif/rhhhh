import{_ as re}from"./B9ORdSW3.js";import{_ as xe}from"./BUmjikbw.js";import{_ as ye,H as _e}from"./CaI1XxGN.js";import{_ as he,a as $e}from"./C0CVT-Gk.js";import{e as ie,r as _,x as ne,c as h,o as g,a as e,k as U,t as p,i as t,F as te,y as se,q,b as n,m as Q,w as x,d as v,A as P,B as le,l as ae,j as F,G as Ve,H as M}from"./BlCT4Jl9.js";import{_ as we}from"./1mwErJ78.js";import{_ as Ee}from"./CrqGUWOX.js";const De={class:"space-y-6"},Ce={class:"bg-gray-50 rounded-xl p-4"},Se={class:"font-semibold text-gray-900 mb-2"},ke={key:0,class:"text-sm text-gray-500"},ze={key:1,class:"grid grid-cols-2 gap-2 text-sm"},Ue={class:"ml-2 font-medium"},Ne={class:"ml-2 font-medium"},Ae={key:0,class:"col-span-2"},Fe={class:"ml-2 font-medium"},Te={key:1,class:"col-span-2"},He={class:"ml-2 font-medium"},Pe={class:"border-b border-gray-200"},Ie={class:"-mb-px flex space-x-8"},je=["onClick"],Re={key:0,class:"space-y-4"},Me={class:"grid grid-cols-2 gap-4"},Oe={class:"grid grid-cols-2 gap-4"},Be={key:1,class:"space-y-4"},Ge={class:"grid grid-cols-2 gap-4"},Le={class:"grid grid-cols-2 gap-4"},qe={class:"grid grid-cols-2 gap-4"},Ze={class:"bg-green-50 p-4 rounded-lg"},Je={class:"flex justify-between items-center"},Xe={class:"text-xl font-bold text-green-700"},Ye={key:2,class:"space-y-4"},Qe={class:"grid grid-cols-2 gap-4"},Ke={class:"grid grid-cols-2 gap-4"},We={class:"grid grid-cols-2 gap-4"},eo={class:"grid grid-cols-2 gap-4"},oo={class:"bg-red-50 p-4 rounded-lg"},ao={class:"flex justify-between items-center"},to={class:"text-xl font-bold text-red-700"},so={key:3,class:"space-y-4"},lo={key:0,class:"space-y-3 mb-6"},ro={class:"flex justify-between items-start"},io={class:"flex-1"},no={class:"flex items-center gap-2 mb-2"},uo={class:"font-semibold text-gray-900"},co={class:"text-sm text-gray-500 mt-1"},mo={key:0,class:"text-sm text-gray-400 mt-1"},po=["onClick"],vo={key:1,class:"text-center py-8 text-gray-500"},bo={key:3,class:"bg-gray-50 rounded-lg p-4 space-y-4"},fo={class:"grid grid-cols-2 gap-4"},go={class:"grid grid-cols-2 gap-4"},xo={class:"flex gap-3"},yo={class:"bg-blue-50 p-4 rounded-lg border-2 border-blue-200"},_o={class:"space-y-2"},ho={class:"flex justify-between text-sm"},$o={class:"font-semibold text-green-600"},Vo={class:"flex justify-between text-sm"},wo={class:"font-semibold text-red-600"},Eo={class:"border-t border-blue-300 pt-2 flex justify-between"},Do={class:"text-2xl font-bold text-blue-900"},Co={class:"flex justify-end gap-3 pt-4 border-t"},So=ie({__name:"HoleriteEditForm",props:{holerite:{}},emits:["save","cancel"],setup(Z,{emit:b}){const u=Z,j=b,k=_("basicos"),C=_(null),z=_(0),N=_(!0),A=_([]),$=_(!1),w=[{id:"basicos",label:"Dados B√°sicos",icon:"üìã"},{id:"proventos",label:"Proventos",icon:"üí∞"},{id:"descontos",label:"Descontos",icon:"üìâ"},{id:"personalizados",label:"Itens Personalizados",icon:"‚öôÔ∏è"}],r=_({salario_base:u.holerite.salario_base||0,horas_trabalhadas:u.holerite.horas_trabalhadas||0,data_pagamento:u.holerite.data_pagamento||"",observacoes:u.holerite.observacoes||"",bonus:u.holerite.bonus||0,horas_extras:u.holerite.horas_extras||0,adicional_noturno:u.holerite.adicional_noturno||0,adicional_periculosidade:u.holerite.adicional_periculosidade||0,adicional_insalubridade:u.holerite.adicional_insalubridade||0,comissoes:u.holerite.comissoes||0,inss:u.holerite.inss||0,irrf:u.holerite.irrf||0,vale_transporte:u.holerite.vale_transporte||0,vale_refeicao_desconto:u.holerite.vale_refeicao_desconto||0,plano_saude:u.holerite.plano_saude||0,plano_odontologico:u.holerite.plano_odontologico||0,adiantamento:u.holerite.adiantamento||0,faltas:u.holerite.faltas||0}),d=_({tipo:"beneficio",descricao:"",valor:0,vigencia_tipo:"unico",data_inicio:"",data_fim:"",observacoes:""}),V=async()=>{N.value=!0;try{const f=u.holerite.funcionario_id||u.holerite.funcionario?.id;if(!f){console.error("ID do funcion√°rio n√£o encontrado no holerite"),N.value=!1;return}console.log("Buscando dados do funcion√°rio:",f);const a=await $fetch(`/api/funcionarios/${f}`);if(console.log("Funcion√°rio carregado:",a),a.empresa_id){console.log("Buscando empresa:",a.empresa_id);const H=await $fetch(`/api/empresas/${a.empresa_id}`);C.value=H.data||H,console.log("Empresa carregada:",C.value)}const c=a.jornada_id||a.jornada_trabalho_id;if(c){console.log("Buscando jornada:",c);const H=await $fetch(`/api/jornadas/${c}`);console.log("Jornada carregada:",H);const T=H.horas_semanais||0;z.value=Math.round(T*4.33),console.log("Horas semanais:",T,"Horas do m√™s:",z.value),(!r.value.horas_trabalhadas||r.value.horas_trabalhadas===0)&&(r.value.horas_trabalhadas=z.value)}await R(f)}catch(f){console.error("Erro ao carregar dados adicionais:",f)}finally{N.value=!1}},R=async f=>{try{const a=await $fetch(`/api/holerites/itens-personalizados/${f}`);a.warning&&console.warn("‚ö†Ô∏è",a.warning),A.value=a.data||[]}catch(a){console.error("Erro ao carregar itens personalizados:",a),A.value=[],(a.message?.includes("PGRST205")||a.message?.includes("not exist"))&&(console.error("‚ùå A tabela holerite_itens_personalizados n√£o existe!"),console.error("üìã Execute o arquivo: EXECUTAR-ITENS-PERSONALIZADOS.sql no Supabase SQL Editor"))}},O=async()=>{try{const f=u.holerite.funcionario_id||u.holerite.funcionario?.id;if(!d.value.descricao||!d.value.valor||!d.value.data_inicio){alert("‚ö†Ô∏è Preencha todos os campos obrigat√≥rios");return}const a=d.value.vigencia_tipo==="unico"?d.value.data_inicio:d.value.data_fim||null;await $fetch("/api/holerites/itens-personalizados",{method:"POST",body:{funcionario_id:f,tipo:d.value.tipo,descricao:d.value.descricao,valor:Number(d.value.valor),vigencia_tipo:d.value.vigencia_tipo,data_inicio:d.value.data_inicio,data_fim:a,observacoes:d.value.observacoes}}),await R(f),J(),alert("‚úÖ Item adicionado com sucesso!")}catch(f){console.error("Erro ao adicionar item:",f),f.message?.includes("n√£o existe")||f.message?.includes("EXECUTAR-ITENS-PERSONALIZADOS")?alert(`‚ùå Erro: A tabela n√£o existe no banco de dados.

üìã Execute o arquivo EXECUTAR-ITENS-PERSONALIZADOS.sql no Supabase SQL Editor.

Veja a documenta√ß√£o em: docs/CORRECAO-ITENS-PERSONALIZADOS.md`):alert("‚ùå Erro ao adicionar item: "+f.message)}},S=async f=>{if(confirm("Deseja realmente remover este item?"))try{await $fetch(`/api/holerites/itens-personalizados/${f}`,{method:"DELETE"});const a=u.holerite.funcionario_id||u.holerite.funcionario?.id;await R(a),alert("Item removido com sucesso!")}catch(a){console.error("Erro ao remover item:",a),alert("Erro ao remover item")}},J=()=>{$.value=!1,d.value={tipo:"beneficio",descricao:"",valor:0,vigencia_tipo:"unico",data_inicio:"",data_fim:"",observacoes:""}},B=()=>Number(r.value.salario_base)+Number(r.value.bonus)+Number(r.value.horas_extras)+Number(r.value.adicional_noturno)+Number(r.value.adicional_periculosidade)+Number(r.value.adicional_insalubridade)+Number(r.value.comissoes),G=()=>Number(r.value.inss)+Number(r.value.irrf)+Number(r.value.vale_transporte)+Number(r.value.vale_refeicao_desconto)+Number(r.value.plano_saude)+Number(r.value.plano_odontologico)+Number(r.value.adiantamento)+Number(r.value.faltas),X=()=>B()-G(),I=f=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(f),K=f=>f.replace(/\D/g,"").replace(/^(\d{2})(\d{3})(\d{3})(\d{4})(\d{2})$/,"$1.$2.$3/$4-$5"),L=f=>f?new Date(f+"T00:00:00").toLocaleDateString("pt-BR"):"",Y=()=>{j("save",r.value)};return ne(()=>{V()}),(f,a)=>{const c=we,H=Ee,T=re;return g(),h("div",De,[e("div",Ce,[e("h3",Se,p(Z.holerite.funcionario.nome_completo),1),t(N)?(g(),h("div",ke," ‚è≥ Carregando informa√ß√µes... ")):(g(),h("div",ze,[e("div",null,[a[27]||(a[27]=e("span",{class:"text-gray-600"},"Cargo:",-1)),e("span",Ue,p(Z.holerite.funcionario.cargo),1)]),e("div",null,[a[28]||(a[28]=e("span",{class:"text-gray-600"},"Empresa:",-1)),e("span",Ne,p(t(C)?t(C).nome_fantasia||t(C).nome||"N√£o definida":"N√£o encontrada"),1)]),t(C)?.cnpj?(g(),h("div",Ae,[a[29]||(a[29]=e("span",{class:"text-gray-600"},"CNPJ:",-1)),e("span",Fe,p(K(t(C).cnpj)),1)])):U("",!0),t(z)>0?(g(),h("div",Te,[a[30]||(a[30]=e("span",{class:"text-gray-600"},"Horas Padr√£o do M√™s:",-1)),e("span",He,p(t(z))+"h",1)])):U("",!0)]))]),e("div",Pe,[e("nav",Ie,[(g(),h(te,null,se(w,l=>e("button",{key:l.id,onClick:W=>k.value=l.id,class:q(["py-2 px-1 border-b-2 font-medium text-sm transition-colors",t(k)===l.id?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"])},p(l.icon)+" "+p(l.label),11,je)),64))])]),t(k)==="basicos"?(g(),h("div",Re,[e("div",Me,[n(c,{modelValue:t(r).salario_base,"onUpdate:modelValue":a[0]||(a[0]=l=>t(r).salario_base=l),type:"number",label:"Sal√°rio Base",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).horas_trabalhadas,"onUpdate:modelValue":a[1]||(a[1]=l=>t(r).horas_trabalhadas=l),type:"number",label:"Horas Trabalhadas no M√™s",placeholder:`Padr√£o: ${t(z)}h`,step:"0.01"},null,8,["modelValue","placeholder"])]),e("div",Oe,[n(c,{modelValue:t(r).data_pagamento,"onUpdate:modelValue":a[2]||(a[2]=l=>t(r).data_pagamento=l),type:"date",label:"Data de Pagamento"},null,8,["modelValue"]),n(c,{modelValue:t(r).observacoes,"onUpdate:modelValue":a[3]||(a[3]=l=>t(r).observacoes=l),label:"Observa√ß√µes",placeholder:"Observa√ß√µes sobre este holerite"},null,8,["modelValue"])])])):U("",!0),t(k)==="proventos"?(g(),h("div",Be,[e("div",Ge,[n(c,{modelValue:t(r).bonus,"onUpdate:modelValue":a[4]||(a[4]=l=>t(r).bonus=l),type:"number",label:"B√¥nus",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).horas_extras,"onUpdate:modelValue":a[5]||(a[5]=l=>t(r).horas_extras=l),type:"number",label:"Horas Extras",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",Le,[n(c,{modelValue:t(r).adicional_noturno,"onUpdate:modelValue":a[6]||(a[6]=l=>t(r).adicional_noturno=l),type:"number",label:"Adicional Noturno",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).adicional_periculosidade,"onUpdate:modelValue":a[7]||(a[7]=l=>t(r).adicional_periculosidade=l),type:"number",label:"Adicional de Periculosidade",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",qe,[n(c,{modelValue:t(r).adicional_insalubridade,"onUpdate:modelValue":a[8]||(a[8]=l=>t(r).adicional_insalubridade=l),type:"number",label:"Adicional de Insalubridade",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).comissoes,"onUpdate:modelValue":a[9]||(a[9]=l=>t(r).comissoes=l),type:"number",label:"Comiss√µes",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",Ze,[e("div",Je,[a[31]||(a[31]=e("span",{class:"font-semibold text-green-700"},"Total de Proventos:",-1)),e("span",Xe,p(I(B())),1)])])])):U("",!0),t(k)==="descontos"?(g(),h("div",Ye,[e("div",Qe,[n(c,{modelValue:t(r).inss,"onUpdate:modelValue":a[10]||(a[10]=l=>t(r).inss=l),type:"number",label:"INSS",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).irrf,"onUpdate:modelValue":a[11]||(a[11]=l=>t(r).irrf=l),type:"number",label:"IRRF",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",Ke,[n(c,{modelValue:t(r).vale_transporte,"onUpdate:modelValue":a[12]||(a[12]=l=>t(r).vale_transporte=l),type:"number",label:"Vale Transporte",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).vale_refeicao_desconto,"onUpdate:modelValue":a[13]||(a[13]=l=>t(r).vale_refeicao_desconto=l),type:"number",label:"Vale Refei√ß√£o",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",We,[n(c,{modelValue:t(r).plano_saude,"onUpdate:modelValue":a[14]||(a[14]=l=>t(r).plano_saude=l),type:"number",label:"Plano de Sa√∫de",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).plano_odontologico,"onUpdate:modelValue":a[15]||(a[15]=l=>t(r).plano_odontologico=l),type:"number",label:"Plano Odontol√≥gico",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",eo,[n(c,{modelValue:t(r).adiantamento,"onUpdate:modelValue":a[16]||(a[16]=l=>t(r).adiantamento=l),type:"number",label:"Adiantamento",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),n(c,{modelValue:t(r).faltas,"onUpdate:modelValue":a[17]||(a[17]=l=>t(r).faltas=l),type:"number",label:"Faltas",placeholder:"0.00",step:"0.01"},null,8,["modelValue"])]),e("div",oo,[e("div",ao,[a[32]||(a[32]=e("span",{class:"font-semibold text-red-700"},"Total de Descontos:",-1)),e("span",to,p(I(G())),1)])])])):U("",!0),t(k)==="personalizados"?(g(),h("div",so,[n(H,{variant:"info",class:"mb-4"},{default:x(()=>[...a[33]||(a[33]=[v(" Adicione benef√≠cios ou descontos personalizados que ser√£o aplicados automaticamente nos holerites do funcion√°rio durante o per√≠odo definido. ",-1)])]),_:1}),t(A).length>0?(g(),h("div",lo,[a[34]||(a[34]=e("h4",{class:"font-semibold text-gray-700"},"Itens Ativos",-1)),(g(!0),h(te,null,se(t(A),l=>(g(),h("div",{key:l.id,class:"bg-white border rounded-lg p-4"},[e("div",ro,[e("div",io,[e("div",no,[e("span",{class:q(["px-2 py-1 rounded text-xs font-semibold",l.tipo==="beneficio"?"bg-green-100 text-green-700":"bg-red-100 text-red-700"])},p(l.tipo==="beneficio"?"üí∞ Benef√≠cio":"üìâ Desconto"),3),e("span",{class:q(["px-2 py-1 rounded text-xs font-semibold",l.vigencia_tipo==="unico"?"bg-blue-100 text-blue-700":"bg-purple-100 text-purple-700"])},p(l.vigencia_tipo==="unico"?"üìÖ √önico":"üîÑ Recorrente"),3)]),e("p",uo,p(l.descricao),1),e("p",{class:q(["text-lg font-bold",l.tipo==="beneficio"?"text-green-600":"text-red-600"])},p(I(l.valor)),3),e("p",co," Vig√™ncia: "+p(L(l.data_inicio))+" "+p(l.data_fim?`at√© ${L(l.data_fim)}`:"(sem data fim)"),1),l.observacoes?(g(),h("p",mo,p(l.observacoes),1)):U("",!0)]),e("button",{onClick:W=>S(l.id),class:"text-red-500 hover:text-red-700 p-2",title:"Remover item"}," üóëÔ∏è ",8,po)])]))),128))])):(g(),h("div",vo," Nenhum item personalizado cadastrado ")),t($)?U("",!0):(g(),Q(T,{key:2,onClick:a[18]||(a[18]=l=>$.value=!0),variant:"secondary",class:"w-full"},{default:x(()=>[...a[35]||(a[35]=[v(" ‚ûï Adicionar Novo Item ",-1)])]),_:1})),t($)?(g(),h("div",bo,[a[42]||(a[42]=e("h4",{class:"font-semibold text-gray-700"},"Novo Item Personalizado",-1)),e("div",fo,[e("div",null,[a[37]||(a[37]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),P(e("select",{"onUpdate:modelValue":a[19]||(a[19]=l=>t(d).tipo=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...a[36]||(a[36]=[e("option",{value:"beneficio"},"üí∞ Benef√≠cio (Provento)",-1),e("option",{value:"desconto"},"üìâ Desconto",-1)])],512),[[le,t(d).tipo]])]),e("div",null,[a[39]||(a[39]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Vig√™ncia",-1)),P(e("select",{"onUpdate:modelValue":a[20]||(a[20]=l=>t(d).vigencia_tipo=l),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"},[...a[38]||(a[38]=[e("option",{value:"unico"},"üìÖ √önico (apenas este m√™s)",-1),e("option",{value:"recorrente"},"üîÑ Recorrente (v√°rios meses)",-1)])],512),[[le,t(d).vigencia_tipo]])])]),n(c,{modelValue:t(d).descricao,"onUpdate:modelValue":a[21]||(a[21]=l=>t(d).descricao=l),label:"Descri√ß√£o",placeholder:"Ex: B√¥nus de produtividade, Desconto de uniforme..."},null,8,["modelValue"]),n(c,{modelValue:t(d).valor,"onUpdate:modelValue":a[22]||(a[22]=l=>t(d).valor=l),type:"number",label:"Valor",placeholder:"0.00",step:"0.01"},null,8,["modelValue"]),e("div",go,[n(c,{modelValue:t(d).data_inicio,"onUpdate:modelValue":a[23]||(a[23]=l=>t(d).data_inicio=l),type:"date",label:"Data In√≠cio"},null,8,["modelValue"]),n(c,{modelValue:t(d).data_fim,"onUpdate:modelValue":a[24]||(a[24]=l=>t(d).data_fim=l),type:"date",label:"Data Fim (opcional)",disabled:t(d).vigencia_tipo==="unico"},null,8,["modelValue","disabled"])]),n(c,{modelValue:t(d).observacoes,"onUpdate:modelValue":a[25]||(a[25]=l=>t(d).observacoes=l),label:"Observa√ß√µes (opcional)",placeholder:"Informa√ß√µes adicionais..."},null,8,["modelValue"]),e("div",xo,[n(T,{onClick:O,class:"flex-1"},{default:x(()=>[...a[40]||(a[40]=[v(" ‚úÖ Adicionar ",-1)])]),_:1}),n(T,{variant:"secondary",onClick:J,class:"flex-1"},{default:x(()=>[...a[41]||(a[41]=[v(" ‚ùå Cancelar ",-1)])]),_:1})])])):U("",!0)])):U("",!0),e("div",yo,[e("div",_o,[e("div",ho,[a[43]||(a[43]=e("span",{class:"text-gray-700"},"Total Proventos:",-1)),e("span",$o,p(I(B())),1)]),e("div",Vo,[a[44]||(a[44]=e("span",{class:"text-gray-700"},"Total Descontos:",-1)),e("span",wo,"- "+p(I(G())),1)]),e("div",Eo,[a[45]||(a[45]=e("span",{class:"font-bold text-blue-900"},"Sal√°rio L√≠quido:",-1)),e("span",Do,p(I(X())),1)])])]),e("div",Co,[n(T,{variant:"secondary",onClick:a[26]||(a[26]=l=>f.$emit("cancel"))},{default:x(()=>[...a[46]||(a[46]=[v(" Cancelar ",-1)])]),_:1}),n(T,{onClick:Y},{default:x(()=>[...a[47]||(a[47]=[v(" üíæ Salvar Altera√ß√µes ",-1)])]),_:1})])])}}}),ko=Object.assign(So,{__name:"HoleritesHoleriteEditForm"}),zo={class:"space-y-6"},Uo={class:"flex items-center justify-between"},No={class:"flex gap-3"},Ao={class:"bg-white p-4 rounded-xl border border-gray-200"},Fo={class:"grid grid-cols-1 md:grid-cols-4 gap-4"},To={class:"flex items-end"},Ho={class:"bg-white rounded-xl border border-gray-200"},Po={class:"p-6 border-b border-gray-200"},Io={class:"text-sm text-gray-600"},jo={key:0,class:"p-8 text-center"},Ro={key:1,class:"p-8"},Mo={key:2,class:"divide-y divide-gray-200"},Oo={class:"flex items-center justify-between"},Bo={class:"flex items-center gap-4"},Go={class:"w-12 h-12 bg-blue-100 rounded-full flex items-center justify-center"},Lo={class:"text-blue-600 font-semibold"},qo={class:"font-semibold text-gray-900"},Zo={class:"text-sm text-gray-600"},Jo={class:"text-xs text-gray-500"},Xo={class:"flex items-center gap-4"},Yo={class:"text-right"},Qo={class:"font-semibold text-gray-900"},Ko={class:"text-sm text-gray-600"},Wo={class:"flex gap-2"},ea={class:"space-y-4"},oa={key:0,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},aa={key:1,class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ta={class:"flex items-center gap-3 p-4 bg-yellow-50 border border-yellow-200 rounded-lg"},sa={class:"flex gap-3 justify-end pt-4 border-t"},la={class:"space-y-4"},ra={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},ia={class:"space-y-3"},na={class:"flex items-center gap-3 p-3 bg-white rounded-lg border border-blue-200"},da={class:"flex items-center gap-3 p-3 bg-white rounded-lg border border-blue-200"},ua={class:"flex items-center gap-3 p-3 bg-white rounded-lg border border-blue-200"},ca={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ma={class:"text-sm text-gray-700"},pa={class:"flex gap-3 justify-end pt-4 border-t"},va={class:"space-y-4"},ba={class:"bg-blue-50 border border-blue-200 rounded-lg p-4"},fa={class:"space-y-3"},ga={class:"flex items-center gap-3 p-3 bg-white rounded-lg border border-blue-200"},xa={class:"flex items-center gap-3 p-3 bg-white rounded-lg border border-blue-200"},ya={class:"flex items-center gap-3 p-3 bg-white rounded-lg border border-blue-200"},_a={class:"bg-gray-50 border border-gray-200 rounded-lg p-4"},ha={class:"text-sm text-gray-700"},$a={class:"flex gap-3 justify-end pt-4 border-t"},za=ie({__name:"holerites",setup(Z){const b=_(!1),u=_([]),j=_(!1),k=_(!1),C=_(!1),z=_(!1),N=_(!1),A=_("mensal"),$=_("todos"),w=_("todos"),r=_(null),d=_(!1),V=_({title:"",message:"",variant:"info"}),R=_([]),O=_({recriar:!1}),S=_({empresa:"",mes:"",status:""}),J=ae(()=>[{value:"",label:"Todas as empresas"},...R.value.map(s=>({value:s.id.toString(),label:s.nome_fantasia}))]),B=ae(()=>{const s=[{value:"",label:"Todos os per√≠odos"}],o=new Date;for(let m=0;m<12;m++){const E=new Date(o.getFullYear(),o.getMonth()-m,1),y=`${E.getFullYear()}-${String(E.getMonth()+1).padStart(2,"0")}`,D=E.toLocaleDateString("pt-BR",{month:"long",year:"numeric"});s.push({value:y,label:D})}return s}),G=ae(()=>[{value:"",label:"Todos os status"},{value:"gerado",label:"Gerado"},{value:"enviado",label:"Enviado"},{value:"visualizado",label:"Visualizado"}]),X=s=>{A.value=s,C.value=!0},I=()=>{$.value="todos",z.value=!0},K=()=>{w.value="todos",N.value=!0},L=()=>$.value==="todos"?u.value.filter(s=>s.status!=="enviado").length:$.value==="adiantamento"?u.value.filter(s=>new Date(s.periodo_fim).getDate()<=15&&s.status!=="enviado").length:u.value.filter(s=>new Date(s.periodo_fim).getDate()>15&&s.status!=="enviado").length,Y=()=>w.value==="todos"?u.value.length:w.value==="adiantamento"?u.value.filter(s=>new Date(s.periodo_fim).getDate()<=15).length:u.value.filter(s=>new Date(s.periodo_fim).getDate()>15).length,f=async()=>{N.value=!1,await a()},a=async()=>{b.value=!0;try{let s=[];if(w.value==="todos"?s=u.value:w.value==="adiantamento"?s=u.value.filter(y=>new Date(y.periodo_fim).getDate()<=15):s=u.value.filter(y=>new Date(y.periodo_fim).getDate()>15),s.length===0){V.value={title:"Aviso",message:"Nenhum holerite para disponibilizar",variant:"warning"},d.value=!0,b.value=!1;return}let o=0,m=0;for(const y of s)try{await $fetch(`/api/holerites/${y.id}`,{method:"PATCH",body:{status:"visualizado"}}),o++}catch(D){console.error(`Erro ao disponibilizar holerite ${y.id}:`,D),m++}const E=w.value==="adiantamento"?"adiantamentos":w.value==="mensal"?"folhas mensais":"holerites";V.value={title:"Disponibiliza√ß√£o Conclu√≠da!",message:`${o} ${E} disponibilizado(s) no perfil${m>0?` (${m} erro(s))`:""}`,variant:m>0?"warning":"success"},d.value=!0,await c()}catch(s){V.value={title:"Erro!",message:s.data?.message||"Erro ao disponibilizar holerites",variant:"error"},d.value=!0}finally{b.value=!1}},c=async()=>{b.value=!0;try{const s={};S.value.empresa&&(s.empresa=S.value.empresa),S.value.mes&&(s.mes=S.value.mes),S.value.status&&(s.status=S.value.status);const o=await $fetch("/api/holerites",{params:s});u.value=o}catch(s){console.error("Erro ao carregar holerites:",s),V.value={title:"Erro!",message:"Erro ao carregar holerites do banco de dados",variant:"error"},d.value=!0}finally{b.value=!1}},H=async()=>{b.value=!0;try{const s=new Date,o=s.getFullYear(),m=String(s.getMonth()+1).padStart(2,"0");let E,y;if(A.value==="adiantamento")E=`${o}-${m}-01`,y=`${o}-${m}-15`;else{E=`${o}-${m}-01`;const ee=new Date(o,s.getMonth()+1,0).getDate();y=`${o}-${m}-${String(ee).padStart(2,"0")}`}const D=await $fetch("/api/holerites/gerar",{method:"POST",body:{periodo_inicio:E,periodo_fim:y,tipo:A.value,recriar:O.value.recriar}});V.value={title:"Sucesso!",message:D.message||`${A.value==="adiantamento"?"Adiantamentos":"Holerites"} gerados com sucesso`,variant:"success"},d.value=!0,await c()}catch(s){V.value={title:"Erro!",message:s.data?.message||"Erro ao gerar holerites automaticamente",variant:"error"},d.value=!0}finally{b.value=!1}},T=async()=>{C.value=!1,await H()},l=async()=>{z.value=!1,await W()},W=async()=>{b.value=!0;try{let s=[];if($.value==="todos"?s=u.value.filter(y=>y.status!=="enviado"):$.value==="adiantamento"?s=u.value.filter(y=>new Date(y.periodo_fim).getDate()<=15&&y.status!=="enviado"):s=u.value.filter(y=>new Date(y.periodo_fim).getDate()>15&&y.status!=="enviado"),s.length===0){V.value={title:"Aviso",message:"Nenhum holerite para enviar",variant:"warning"},d.value=!0,b.value=!1;return}let o=0,m=0;for(const y of s)try{await $fetch(`/api/holerites/${y.id}/enviar-email`,{method:"POST"}),o++}catch(D){console.error(`Erro ao enviar holerite ${y.id}:`,D),m++}const E=$.value==="adiantamento"?"adiantamentos":$.value==="mensal"?"folhas mensais":"holerites";V.value={title:"Envio Conclu√≠do!",message:`${o} ${E} enviado(s) com sucesso${m>0?` (${m} erro(s))`:""}`,variant:m>0?"warning":"success"},d.value=!0,await c()}catch(s){V.value={title:"Erro!",message:s.data?.message||"Erro ao enviar holerites",variant:"error"},d.value=!0}finally{b.value=!1}},de=s=>{r.value=s,j.value=!0},ue=s=>{r.value={...s},k.value=!0},ce=async s=>{try{b.value=!0;const o=await $fetch(`/api/holerites/${s.id}/enviar-email`,{method:"POST"});s.status="enviado",V.value={title:"Enviado!",message:`Holerite enviado para ${s.funcionario.nome_completo} (${o.email})`,variant:"success"},d.value=!0,await c()}catch(o){V.value={title:"Erro!",message:o.data?.message||"Erro ao enviar holerite",variant:"error"},d.value=!0}finally{b.value=!1}},me=async s=>{if(r.value)try{b.value=!0;const o=await $fetch(`/api/holerites/${r.value.id}`,{method:"PATCH",body:s});k.value=!1,V.value={title:"Salvo!",message:"Holerite atualizado com sucesso",variant:"success"},d.value=!0,await c()}catch(o){V.value={title:"Erro!",message:o.data?.message||"Erro ao salvar altera√ß√µes",variant:"error"},d.value=!0}finally{b.value=!1}},pe=()=>{c()},ve=async s=>{if(confirm(`Tem certeza que deseja excluir o holerite de ${s.funcionario.nome_completo}?

Esta a√ß√£o n√£o pode ser desfeita.`))try{b.value=!0,await $fetch(`/api/holerites/${s.id}`,{method:"DELETE"}),V.value={title:"Exclu√≠do!",message:`Holerite de ${s.funcionario.nome_completo} exclu√≠do com sucesso`,variant:"success"},d.value=!0,await c()}catch(o){V.value={title:"Erro!",message:o.data?.message||"Erro ao excluir holerite",variant:"error"},d.value=!0}finally{b.value=!1}},be=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s),fe=(s,o)=>{const m=new Date(s).toLocaleDateString("pt-BR"),E=new Date(o).toLocaleDateString("pt-BR");return`${m} - ${E}`},ge=s=>({gerado:"Gerado",enviado:"Enviado",visualizado:"Visualizado"})[s]||s;return ne(async()=>{try{const s=await $fetch("/api/empresas");Array.isArray(s)&&(R.value=s)}catch(s){console.error("Erro ao carregar empresas:",s)}c()}),(s,o)=>{const m=re,E=xe,y=ye,D=he,ee=$e;return g(),h("div",zo,[e("div",Uo,[o[27]||(o[27]=e("div",null,[e("h1",{class:"text-2xl font-bold text-gray-900"},"üìÑ Gest√£o de Holerites"),e("p",{class:"text-gray-600"},"Gerencie e envie holerites para os funcion√°rios")],-1)),e("div",No,[n(m,{variant:"secondary",onClick:o[0]||(o[0]=i=>X("adiantamento")),disabled:t(b)},{default:x(()=>[...o[23]||(o[23]=[v(" üí∞ Gerar Adiantamento (40%) ",-1)])]),_:1},8,["disabled"]),n(m,{onClick:o[1]||(o[1]=i=>X("mensal")),disabled:t(b)},{default:x(()=>[...o[24]||(o[24]=[v(" üìÑ Gerar Folha Mensal ",-1)])]),_:1},8,["disabled"]),n(m,{variant:"ghost",onClick:K,disabled:t(b)||t(u).length===0},{default:x(()=>[...o[25]||(o[25]=[v(" üë§ Disponibilizar no Perfil ",-1)])]),_:1},8,["disabled"]),n(m,{variant:"ghost",onClick:I,disabled:t(b)||t(u).length===0},{default:x(()=>[...o[26]||(o[26]=[v(" üìß Enviar por Email ",-1)])]),_:1},8,["disabled"])])]),e("div",Ao,[e("div",Fo,[n(E,{modelValue:t(S).empresa,"onUpdate:modelValue":o[2]||(o[2]=i=>t(S).empresa=i),options:t(J),label:"Empresa",placeholder:"Todas as empresas"},null,8,["modelValue","options"]),n(E,{modelValue:t(S).mes,"onUpdate:modelValue":o[3]||(o[3]=i=>t(S).mes=i),options:t(B),label:"M√™s/Ano",placeholder:"Selecione o per√≠odo"},null,8,["modelValue","options"]),n(E,{modelValue:t(S).status,"onUpdate:modelValue":o[4]||(o[4]=i=>t(S).status=i),options:t(G),label:"Status",placeholder:"Todos os status"},null,8,["modelValue","options"]),e("div",To,[n(m,{variant:"secondary",onClick:pe,class:"w-full"},{default:x(()=>[...o[28]||(o[28]=[v(" üîç Filtrar ",-1)])]),_:1})])])]),e("div",Ho,[e("div",Po,[o[29]||(o[29]=e("h2",{class:"text-lg font-semibold text-gray-900"},"Holerites Gerados",-1)),e("p",Io,p(t(u).length)+" holerite(s) encontrado(s)",1)]),t(b)?(g(),h("div",jo,[...o[30]||(o[30]=[e("div",{class:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"},null,-1),e("p",{class:"mt-2 text-gray-600"},"Carregando holerites...",-1)])])):t(u).length===0?(g(),h("div",Ro,[n(y,{title:"Nenhum holerite encontrado",description:"Gere holerites autom√°ticos ou ajuste os filtros",icon:"document"})])):(g(),h("div",Mo,[(g(!0),h(te,null,se(t(u),i=>(g(),h("div",{key:i.id,class:"p-6 hover:bg-gray-50 transition-colors"},[e("div",Oo,[e("div",Bo,[e("div",Go,[e("span",Lo,p(i.funcionario.nome_completo.charAt(0)),1)]),e("div",null,[e("h3",qo,p(i.funcionario.nome_completo),1),e("p",Zo,p(i.funcionario.cargo||"Cargo n√£o definido"),1),e("p",Jo,p(i.funcionario.empresa||"Empresa n√£o definida"),1)])]),e("div",Xo,[e("div",Yo,[e("p",Qo,p(be(i.salario_liquido)),1),e("p",Ko,p(fe(i.periodo_inicio,i.periodo_fim)),1),e("span",{class:q(["inline-flex items-center px-2 py-1 rounded-full text-xs font-medium",i.status==="enviado"?"bg-green-100 text-green-800":i.status==="gerado"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"])},p(ge(i.status)),3)]),e("div",Wo,[n(m,{variant:"secondary",size:"sm",onClick:oe=>de(i)},{default:x(()=>[...o[31]||(o[31]=[v(" üëÅÔ∏è Ver ",-1)])]),_:1},8,["onClick"]),n(m,{variant:"secondary",size:"sm",onClick:oe=>ue(i)},{default:x(()=>[...o[32]||(o[32]=[v(" ‚úèÔ∏è Editar ",-1)])]),_:1},8,["onClick"]),n(m,{size:"sm",onClick:oe=>ce(i),disabled:i.status==="enviado"},{default:x(()=>[...o[33]||(o[33]=[v(" üìß Enviar ",-1)])]),_:1},8,["onClick","disabled"]),n(m,{variant:"danger",size:"sm",onClick:oe=>ve(i)},{default:x(()=>[...o[34]||(o[34]=[v(" üóëÔ∏è Excluir ",-1)])]),_:1},8,["onClick"])])])])]))),128))]))]),n(D,{modelValue:t(j),"onUpdate:modelValue":o[6]||(o[6]=i=>F(j)?j.value=i:null),title:"Visualizar Holerite","max-width":"max-w-3xl"},{default:x(()=>[t(r)?(g(),Q(_e,{key:0,holerite:t(r),onClose:o[5]||(o[5]=i=>j.value=!1)},null,8,["holerite"])):U("",!0)]),_:1},8,["modelValue"]),n(D,{modelValue:t(k),"onUpdate:modelValue":o[8]||(o[8]=i=>F(k)?k.value=i:null),title:"Editar Holerite","max-width":"max-w-4xl"},{default:x(()=>[t(r)?(g(),Q(ko,{key:0,holerite:t(r),onSave:me,onCancel:o[7]||(o[7]=i=>k.value=!1)},null,8,["holerite"])):U("",!0)]),_:1},8,["modelValue"]),n(D,{modelValue:t(C),"onUpdate:modelValue":o[11]||(o[11]=i=>F(C)?C.value=i:null),title:t(A)==="adiantamento"?"Gerar Adiantamento Salarial":"Gerar Folha Mensal","max-width":"max-w-lg"},{default:x(()=>[e("div",ea,[t(A)==="adiantamento"?(g(),h("div",oa,[...o[35]||(o[35]=[e("p",{class:"text-sm text-blue-800"},[e("strong",null,"üí∞ Adiantamento Salarial (40%):"),e("br"),v(" ‚Ä¢ Gerar adiantamento de 40% do sal√°rio base"),e("br"),v(" ‚Ä¢ Per√≠odo: Primeira quinzena do m√™s atual"),e("br"),v(" ‚Ä¢ O valor ser√° descontado automaticamente na folha mensal"),e("br"),v(" ‚Ä¢ Sem c√°lculo de INSS e IRRF (apenas adiantamento) ")],-1)])])):(g(),h("div",aa,[...o[36]||(o[36]=[e("p",{class:"text-sm text-blue-800"},[e("strong",null,"üìÑ Folha de Pagamento Mensal:"),e("br"),v(" ‚Ä¢ Gerar holerites completos para todos os funcion√°rios ativos"),e("br"),v(" ‚Ä¢ Per√≠odo: M√™s completo"),e("br"),v(" ‚Ä¢ C√°lculos autom√°ticos de INSS, IRRF e descontos"),e("br"),v(" ‚Ä¢ Desconto autom√°tico de adiantamentos j√° pagos ")],-1)])])),e("div",ta,[P(e("input",{type:"checkbox",id:"recriar","onUpdate:modelValue":o[9]||(o[9]=i=>t(O).recriar=i),class:"w-5 h-5 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"},null,512),[[Ve,t(O).recriar]]),o[37]||(o[37]=e("label",{for:"recriar",class:"text-sm text-yellow-800 cursor-pointer"},[e("strong",null,"üîÑ Recriar holerites existentes"),e("br"),e("span",{class:"text-xs"},"Se marcado, holerites j√° gerados para este per√≠odo ser√£o exclu√≠dos e recriados")],-1))]),e("div",sa,[n(m,{variant:"secondary",onClick:o[10]||(o[10]=i=>C.value=!1)},{default:x(()=>[...o[38]||(o[38]=[v(" Cancelar ",-1)])]),_:1}),n(m,{onClick:T,disabled:t(b)},{default:x(()=>[v(p(t(b)?"Gerando...":"‚úì Confirmar Gera√ß√£o"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue","title"]),n(D,{modelValue:t(z),"onUpdate:modelValue":o[16]||(o[16]=i=>F(z)?z.value=i:null),title:"Enviar Holerites por Email","max-width":"max-w-lg"},{default:x(()=>[e("div",la,[e("div",ra,[o[42]||(o[42]=e("p",{class:"text-sm text-blue-800 mb-3"},[e("strong",null,"üìß Selecione o tipo de holerite para enviar:")],-1)),e("div",ia,[e("div",na,[P(e("input",{type:"radio",id:"enviar-adiantamento",value:"adiantamento","onUpdate:modelValue":o[12]||(o[12]=i=>F($)?$.value=i:null),class:"w-4 h-4 text-blue-600"},null,512),[[M,t($)]]),o[39]||(o[39]=e("label",{for:"enviar-adiantamento",class:"flex-1 cursor-pointer"},[e("strong",{class:"text-gray-900"},"üí∞ Apenas Adiantamentos"),e("br"),e("span",{class:"text-xs text-gray-600"},"Enviar apenas holerites de adiantamento (primeira quinzena)")],-1))]),e("div",da,[P(e("input",{type:"radio",id:"enviar-mensal",value:"mensal","onUpdate:modelValue":o[13]||(o[13]=i=>F($)?$.value=i:null),class:"w-4 h-4 text-blue-600"},null,512),[[M,t($)]]),o[40]||(o[40]=e("label",{for:"enviar-mensal",class:"flex-1 cursor-pointer"},[e("strong",{class:"text-gray-900"},"üìÑ Apenas Folhas Mensais"),e("br"),e("span",{class:"text-xs text-gray-600"},"Enviar apenas holerites mensais completos")],-1))]),e("div",ua,[P(e("input",{type:"radio",id:"enviar-todos",value:"todos","onUpdate:modelValue":o[14]||(o[14]=i=>F($)?$.value=i:null),class:"w-4 h-4 text-blue-600"},null,512),[[M,t($)]]),o[41]||(o[41]=e("label",{for:"enviar-todos",class:"flex-1 cursor-pointer"},[e("strong",{class:"text-gray-900"},"üìß Todos os Holerites"),e("br"),e("span",{class:"text-xs text-gray-600"},"Enviar todos os holerites listados")],-1))])])]),e("div",ca,[e("p",ma,[o[43]||(o[43]=e("strong",null,"Total a enviar:",-1)),v(" "+p(L())+" holerite(s) ",1)])]),e("div",pa,[n(m,{variant:"secondary",onClick:o[15]||(o[15]=i=>z.value=!1)},{default:x(()=>[...o[44]||(o[44]=[v(" Cancelar ",-1)])]),_:1}),n(m,{onClick:l,disabled:t(b)||L()===0},{default:x(()=>[v(p(t(b)?"Enviando...":"‚úì Confirmar Envio"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),n(D,{modelValue:t(N),"onUpdate:modelValue":o[21]||(o[21]=i=>F(N)?N.value=i:null),title:"Disponibilizar Holerites no Perfil","max-width":"max-w-lg"},{default:x(()=>[e("div",va,[e("div",ba,[o[48]||(o[48]=e("p",{class:"text-sm text-blue-800 mb-3"},[e("strong",null,"üë§ Selecione o tipo de holerite para disponibilizar:"),e("br"),e("span",{class:"text-xs"},"Os holerites ficar√£o dispon√≠veis para visualiza√ß√£o no perfil do funcion√°rio")],-1)),e("div",fa,[e("div",ga,[P(e("input",{type:"radio",id:"disp-adiantamento",value:"adiantamento","onUpdate:modelValue":o[17]||(o[17]=i=>F(w)?w.value=i:null),class:"w-4 h-4 text-blue-600"},null,512),[[M,t(w)]]),o[45]||(o[45]=e("label",{for:"disp-adiantamento",class:"flex-1 cursor-pointer"},[e("strong",{class:"text-gray-900"},"üí∞ Apenas Adiantamentos"),e("br"),e("span",{class:"text-xs text-gray-600"},"Disponibilizar apenas holerites de adiantamento")],-1))]),e("div",xa,[P(e("input",{type:"radio",id:"disp-mensal",value:"mensal","onUpdate:modelValue":o[18]||(o[18]=i=>F(w)?w.value=i:null),class:"w-4 h-4 text-blue-600"},null,512),[[M,t(w)]]),o[46]||(o[46]=e("label",{for:"disp-mensal",class:"flex-1 cursor-pointer"},[e("strong",{class:"text-gray-900"},"üìÑ Apenas Folhas Mensais"),e("br"),e("span",{class:"text-xs text-gray-600"},"Disponibilizar apenas holerites mensais completos")],-1))]),e("div",ya,[P(e("input",{type:"radio",id:"disp-todos",value:"todos","onUpdate:modelValue":o[19]||(o[19]=i=>F(w)?w.value=i:null),class:"w-4 h-4 text-blue-600"},null,512),[[M,t(w)]]),o[47]||(o[47]=e("label",{for:"disp-todos",class:"flex-1 cursor-pointer"},[e("strong",{class:"text-gray-900"},"üìã Todos os Holerites"),e("br"),e("span",{class:"text-xs text-gray-600"},"Disponibilizar todos os holerites listados")],-1))])])]),e("div",_a,[e("p",ha,[o[49]||(o[49]=e("strong",null,"Total a disponibilizar:",-1)),v(" "+p(Y())+" holerite(s) ",1)]),o[50]||(o[50]=e("p",{class:"text-xs text-gray-500 mt-2"},' Os funcion√°rios poder√£o visualizar e baixar seus holerites na √°rea "Meus Holerites" ',-1))]),e("div",$a,[n(m,{variant:"secondary",onClick:o[20]||(o[20]=i=>N.value=!1)},{default:x(()=>[...o[51]||(o[51]=[v(" Cancelar ",-1)])]),_:1}),n(m,{onClick:f,disabled:t(b)||Y()===0},{default:x(()=>[v(p(t(b)?"Disponibilizando...":"‚úì Confirmar"),1)]),_:1},8,["disabled"])])])]),_:1},8,["modelValue"]),t(d)?(g(),Q(ee,{key:0,show:t(d),title:t(V).title,message:t(V).message,variant:t(V).variant,onClose:o[22]||(o[22]=i=>d.value=!1)},null,8,["show","title","message","variant"])):U("",!0)])}}});export{za as default};
