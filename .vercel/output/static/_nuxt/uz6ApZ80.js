import{_ as Y}from"./B9ORdSW3.js";import{H as X,_ as Z}from"./CaI1XxGN.js";import{e as G,l as A,c as y,k,o as v,q as Q,a as e,t as b,i as m,b as C,w as E,d as L,f as ee,z as oe,r as S,x as te,A as B,B as U,j as V,F as I,y as N,g as ae,m as J,n as ie}from"./BlCT4Jl9.js";const K=()=>{const l=a=>{const i=["01-01","04-21","05-01","09-07","10-12","11-02","11-15","12-25"],c=a.toISOString().slice(5,10);return i.includes(c)},z=a=>{const i=a.getDay();return i===0||i===6},x=a=>!z(a)&&!l(a),r=a=>{const i=new Date(a);for(;!x(i);)i.setDate(i.getDate()-1);return i},$=(a,i)=>{const c=new Date(a,i-1,20);if(x(c)){const d=new Date(c);return d.setDate(d.getDate()-2),x(d)?d:r(d)}else{const d=r(c),g=new Date(d);return g.setDate(g.getDate()-2),x(g)?g:r(g)}};return{isFeriado:l,isFimDeSemana:z,isDiaUtil:x,obterUltimoDiaUtil:r,calcularDataDisponibilizacaoHolerite20:$,deveEstarDisponivelHolerite20:(a,i)=>{const c=new Date,d=$(a,i);return c>=d},calcularProximasDisponibilizacoes:()=>{const a=new Date,i=[];for(let c=0;c<6;c++){const d=new Date(a.getFullYear(),a.getMonth()+c,1),g=d.getFullYear(),F=d.getMonth()+1;i.push({tipo:"inicio_mes",mes:F,ano:g,dataDisponibilizacao:new Date(g,F-1,1),descricao:`Holerite ${F.toString().padStart(2,"0")}/${g} - 1Âª Quinzena (Manual)`});const P=$(g,F);i.push({tipo:"dia_20",mes:F,ano:g,dataDisponibilizacao:P,descricao:`Holerite ${F.toString().padStart(2,"0")}/${g} - 2Âª Quinzena (AutomÃ¡tico)`})}return i.sort((c,d)=>c.dataDisponibilizacao.getTime()-d.dataDisponibilizacao.getTime())},formatarData:a=>a.toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),formatarDataHora:a=>a.toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}),calcularPeriodoQuinzenal:(a,i,c)=>{if(c===1)return{inicio:new Date(a,i-1,1),fim:new Date(a,i-1,15),descricao:`1Âª Quinzena - 01 a 15/${i.toString().padStart(2,"0")}/${a}`};{const d=new Date(a,i,0).getDate();return{inicio:new Date(a,i-1,16),fim:new Date(a,i-1,d),descricao:`2Âª Quinzena - 16 a ${d}/${i.toString().padStart(2,"0")}/${a}`}}},isSalarioQuinzenal:a=>a?.tipo_salario==="quinzenal",calcularValorQuinzenal:a=>a/2}},le={class:"flex items-start justify-between"},ne={class:"flex-1"},se={class:"flex items-center gap-3 mb-3"},re={class:"flex items-center gap-2 mb-1"},de={class:"text-lg font-bold text-gray-800"},ue={class:"flex items-center gap-2 text-sm text-gray-500"},ce={key:0,class:"px-2 py-0.5 bg-blue-100 text-blue-800 rounded-full text-xs font-medium"},me={class:"grid grid-cols-2 md:grid-cols-4 gap-4 mt-4"},ge={class:"text-sm font-semibold text-green-600"},be={class:"text-sm font-semibold text-red-600"},ve={class:"text-lg font-bold text-blue-600"},pe={key:0},fe={class:"text-sm font-medium text-gray-700"},xe={key:0,class:"mt-3 p-3 bg-blue-50 rounded-lg"},De={class:"text-sm text-blue-800"},ye={class:"flex flex-col gap-2 ml-4"},we=G({__name:"HoleriteCard",props:{holerite:{}},emits:["view","download"],setup(l){const z=l,{formatarData:x}=K(),r=A(()=>!0),$=f=>f?.toFixed(2).replace(".",",")||"0,00",_=f=>{const n={Pago:{bg:"bg-green-100",badge:"bg-green-100 text-green-800"},Pendente:{bg:"bg-yellow-100",badge:"bg-yellow-100 text-yellow-800"},Programado:{bg:"bg-blue-100",badge:"bg-blue-100 text-blue-800"},Cancelado:{bg:"bg-red-100",badge:"bg-red-100 text-red-800"}};return n[f||"Pendente"]||n.Pendente},D=A(()=>z.holerite?.quinzena===1||z.holerite?.tipo?.toLowerCase().includes("adiantamento")||z.holerite?.referencia?.toLowerCase().includes("adiantamento")),p=()=>D.value?{card:"bg-gradient-to-br from-orange-50 to-yellow-50 border-orange-200",icon:"bg-gradient-to-br from-orange-400 to-yellow-500 text-white shadow-lg",badge:"bg-gradient-to-r from-orange-500 to-yellow-600 text-white shadow-sm"}:{card:"bg-gradient-to-br from-blue-50 to-indigo-50 border-blue-200",icon:"bg-gradient-to-br from-blue-500 to-indigo-600 text-white shadow-lg",badge:"bg-gradient-to-r from-blue-600 to-indigo-700 text-white shadow-sm"},H=()=>D.value?"ðŸ’°":"ðŸ“Š",w=()=>D.value?"Adiantamento":"Folha Mensal";return(f,n)=>{const a=Y;return l.holerite?(v(),y("div",{key:0,class:Q(["border rounded-xl p-6 hover:shadow-lg transition-shadow",p().card])},[e("div",le,[e("div",ne,[e("div",se,[e("div",{class:Q(["w-12 h-12 rounded-full flex items-center justify-center text-2xl",p().icon])},b(H()),3),e("div",null,[e("div",re,[e("h3",de,b(l.holerite.referencia),1),e("span",{class:Q(["px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wide",p().badge])},b(w()),3)]),e("div",ue,[e("span",null,b(l.holerite.competencia),1),l.holerite.quinzena?(v(),y("span",ce,b(l.holerite.quinzena)+"Âª Quinzena ",1)):k("",!0),e("span",{class:Q(["px-2 py-0.5 rounded-full text-xs font-medium",_(l.holerite.status).badge])},b(l.holerite.status),3)])])]),e("div",me,[e("div",null,[n[2]||(n[2]=e("div",{class:"text-xs text-gray-500 mb-1"},"Proventos",-1)),e("div",ge," R$ "+b($(l.holerite.totalProventos)),1)]),e("div",null,[n[3]||(n[3]=e("div",{class:"text-xs text-gray-500 mb-1"},"Descontos",-1)),e("div",be," R$ "+b($(l.holerite.totalDescontos)),1)]),e("div",null,[n[4]||(n[4]=e("div",{class:"text-xs text-gray-500 mb-1"},"LÃ­quido",-1)),e("div",ve," R$ "+b($(l.holerite.liquido)),1)]),l.holerite.dataDisponibilizacao?(v(),y("div",pe,[n[5]||(n[5]=e("div",{class:"text-xs text-gray-500 mb-1"},"DisponÃ­vel em",-1)),e("div",fe,b(l.holerite.dataDisponibilizacao?m(x)(l.holerite.dataDisponibilizacao):"N/A"),1)])):k("",!0)]),l.holerite.periodoInicio&&l.holerite.periodoFim?(v(),y("div",xe,[n[6]||(n[6]=e("div",{class:"text-xs text-blue-700 font-medium mb-1"},"ðŸ“… PerÃ­odo de ReferÃªncia",-1)),e("div",De,b(l.holerite.periodoInicio?m(x)(l.holerite.periodoInicio):"N/A")+" atÃ© "+b(l.holerite.periodoFim?m(x)(l.holerite.periodoFim):"N/A"),1)])):k("",!0)]),e("div",ye,[C(a,{variant:"primary",size:"sm",onClick:n[0]||(n[0]=i=>f.$emit("view",l.holerite)),disabled:!m(r)},{default:E(()=>[...n[7]||(n[7]=[L(" ðŸ‘ï¸ Visualizar ",-1)])]),_:1},8,["disabled"]),C(a,{variant:"secondary",size:"sm",onClick:n[1]||(n[1]=i=>f.$emit("download",l.holerite)),disabled:!m(r)},{default:E(()=>[...n[8]||(n[8]=[L(" ðŸ“¥ Baixar PDF ",-1)])]),_:1},8,["disabled"])])])],2)):k("",!0)}}}),_e=Object.assign(we,{__name:"HoleritesHoleriteCard"}),he={class:"bg-white rounded-xl border border-gray-200 p-6 mb-6"},ze={class:"flex flex-col sm:flex-row gap-4"},$e={class:"flex-1"},Fe=["value"],He={class:"flex-1"},Se=["value"],ke={class:"flex-1"},Pe={class:"flex items-end"},Qe={key:0,class:"mb-6 p-4 bg-blue-50 border border-blue-200 rounded-xl"},Ae={key:1,class:"text-center py-12"},Ce={key:2,class:"text-center py-12"},Te={key:3,class:"space-y-4"},Ue=G({__name:"holerites",async setup(l){let z,x;const{user:r}=ee();r.value?.tipo==="admin"&&([z,x]=oe(()=>ie("/admin/holerites")),await z,x());const{getTipoHolerite:$}=K(),_=S(""),D=S(""),p=S(""),H=S(null),w=S([]),f=S(!0),n=A(()=>r.value?.tipo_salario==="quinzenal"),a=[{value:"01",label:"Janeiro"},{value:"02",label:"Fevereiro"},{value:"03",label:"MarÃ§o"},{value:"04",label:"Abril"},{value:"05",label:"Maio"},{value:"06",label:"Junho"},{value:"07",label:"Julho"},{value:"08",label:"Agosto"},{value:"09",label:"Setembro"},{value:"10",label:"Outubro"},{value:"11",label:"Novembro"},{value:"12",label:"Dezembro"}],i=[{value:"2026",label:"2026"},{value:"2025",label:"2025"},{value:"2024",label:"2024"}],c=async()=>{f.value=!0;try{if(!r.value&&(console.log("â³ Aguardando user..."),await new Promise(t=>setTimeout(t,500)),!r.value)){console.error("âŒ User nÃ£o disponÃ­vel apÃ³s espera"),w.value=[],f.value=!1;return}const u=r.value?.id;if(console.log("ðŸ” User value:",r.value),console.log("ðŸ” Funcionario ID:",u),!u){console.error("âŒ ID do funcionÃ¡rio nÃ£o encontrado no user"),w.value=[],f.value=!1;return}console.log("ðŸ“¡ Buscando holerites para funcionÃ¡rio:",u);const o=await $fetch("/api/holerites/meus-holerites",{query:{funcionarioId:u}});console.log("ðŸ“¦ Dados recebidos da API:",o),console.log("ðŸ“Š Quantidade de holerites:",o.length),w.value=o.map(t=>{const h=new Date(t.periodo_inicio),s=new Date(t.periodo_fim),R=String(h.getMonth()+1).padStart(2,"0"),j=String(h.getFullYear());let T="Mensal",M=null,q=`Holerite ${h.toLocaleDateString("pt-BR",{month:"long",year:"numeric"})}`;const O=h.getDate(),W=s.getDate();return O===1&&W<=15?(T="Quinzenal",M=1,q+=" - 1Âª Quinzena"):O===16&&(T="Quinzenal",M=2,q+=" - 2Âª Quinzena"),{id:t.id,referencia:q,competencia:`${R}/${j}`,mes:R,ano:j,quinzena:M,tipo:T,status:t.status||"Pago",salarioBase:t.salario_base||0,bonus:t.bonus||0,totalProventos:t.total_proventos||0,inss:t.inss||0,irrf:t.irrf||0,valeTransporte:t.vale_transporte||0,totalDescontos:t.total_descontos||0,liquido:t.salario_liquido||0,periodoInicio:h,periodoFim:s,dataDisponibilizacao:t.data_pagamento?new Date(t.data_pagamento):null,horas_trabalhadas:t.horas_trabalhadas,horas_extras:t.horas_extras,adicional_noturno:t.adicional_noturno,adicional_periculosidade:t.adicional_periculosidade,adicional_insalubridade:t.adicional_insalubridade,comissoes:t.comissoes,vale_refeicao_desconto:t.vale_refeicao_desconto,plano_saude:t.plano_saude,plano_odontologico:t.plano_odontologico,adiantamento:t.adiantamento,faltas:t.faltas,data_pagamento:t.data_pagamento,observacoes:t.observacoes}}),console.log("âœ… Holerites formatados:",w.value),console.log("ðŸ“Š Total de holerites apÃ³s formataÃ§Ã£o:",w.value.length)}catch(u){console.error("âŒ Erro ao carregar holerites:",u),w.value=[]}finally{f.value=!1}};te(()=>{c()});const d=A(()=>{console.log("ðŸ” Filtrando holerites. Total:",w.value.length),console.log("ðŸ” Filtros ativos:",{mes:_.value,ano:D.value,tipo:p.value});const u=w.value.filter(o=>{if(_.value&&o.mes!==_.value||D.value&&o.ano!==D.value)return!1;if(p.value){const t=$(o);if(p.value==="adiantamento"&&t!=="adiantamento"||p.value==="folha_mensal"&&t!=="folha_mensal")return!1}return!0});return console.log("âœ… Holerites filtrados:",u.length),u}),g=()=>{_.value="",D.value="",p.value=""},F=async u=>{let o="Empresa";try{if(r.value){const t=await $fetch(`/api/funcionarios/${r.value.id}`);if(t.empresa_id){const h=await $fetch(`/api/empresas/${t.empresa_id}`),s=h.data||h;o=s.nome_fantasia||s.nome||"Empresa"}}}catch(t){console.error("Erro ao buscar empresa:",t)}H.value={...u,funcionario:{nome_completo:r.value?.nome||"",cargo:r.value?.cargo||"NÃ£o definido",empresa:o},periodo_inicio:u.periodoInicio,periodo_fim:u.periodoFim,salario_base:u.salarioBase,salario_liquido:u.liquido,total_proventos:u.totalProventos,total_descontos:u.totalDescontos}},P=u=>{window.open(`/api/holerites/${u.id}/pdf`,"_blank")};return(u,o)=>{const t=Y,h=Z;return v(),y("div",null,[e("div",he,[o[11]||(o[11]=e("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"ðŸ” Filtrar Holerites",-1)),e("div",ze,[e("div",$e,[o[5]||(o[5]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"MÃªs",-1)),B(e("select",{"onUpdate:modelValue":o[0]||(o[0]=s=>V(_)?_.value=s:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[o[4]||(o[4]=e("option",{value:""},"Todos os meses",-1)),(v(),y(I,null,N(a,s=>e("option",{key:s.value,value:s.value},b(s.label),9,Fe)),64))],512),[[U,m(_)]])]),e("div",He,[o[7]||(o[7]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Ano",-1)),B(e("select",{"onUpdate:modelValue":o[1]||(o[1]=s=>V(D)?D.value=s:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[o[6]||(o[6]=e("option",{value:""},"Todos os anos",-1)),(v(),y(I,null,N(i,s=>e("option",{key:s.value,value:s.value},b(s.label),9,Se)),64))],512),[[U,m(D)]])]),e("div",ke,[o[9]||(o[9]=e("label",{class:"block text-sm font-medium text-gray-700 mb-1"},"Tipo",-1)),B(e("select",{"onUpdate:modelValue":o[2]||(o[2]=s=>V(p)?p.value=s:null),class:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"},[...o[8]||(o[8]=[e("option",{value:""},"Todos os tipos",-1),e("option",{value:"adiantamento"},"ðŸ’° Adiantamento",-1),e("option",{value:"folha_mensal"},"ðŸ“Š Folha Mensal",-1)])],512),[[U,m(p)]])]),e("div",Pe,[C(t,{variant:"secondary",onClick:g},{default:E(()=>[...o[10]||(o[10]=[L("Limpar",-1)])]),_:1})])])]),m(n)?(v(),y("div",Qe,[...o[12]||(o[12]=[ae('<div class="flex items-start gap-3"><span class="text-2xl">ðŸ¤–</span><div><h3 class="font-semibold text-blue-800 mb-2">Holerites AutomÃ¡ticos</h3><div class="text-sm text-blue-700 space-y-1"><p>â€¢ <strong>2Âª Quinzena:</strong> Disponibilizado automaticamente 2 dias antes do dia 20</p><p>â€¢ <strong>1Âª Quinzena:</strong> Liberado manualmente pelo RH no inÃ­cio do mÃªs</p><p>â€¢ <strong>Fins de semana/Feriados:</strong> Antecipado para o Ãºltimo dia Ãºtil anterior</p></div></div></div>',1)])])):k("",!0),m(r)?m(f)?(v(),y("div",Ce,[...o[14]||(o[14]=[e("div",{class:"inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"},null,-1),e("p",{class:"mt-4 text-gray-600"},"Carregando holerites...",-1)])])):(v(),y("div",Te,[(v(!0),y(I,null,N(m(d),s=>(v(),J(_e,{key:s.id,holerite:s,onView:F,onDownload:P},null,8,["holerite"]))),128)),m(d).length===0?(v(),J(h,{key:0,title:"Nenhum holerite encontrado",description:"Tente ajustar os filtros ou aguarde a geraÃ§Ã£o do prÃ³ximo holerite."})):k("",!0)])):(v(),y("div",Ae,[...o[13]||(o[13]=[e("p",{class:"text-red-600"},"âŒ Erro: UsuÃ¡rio nÃ£o autenticado. FaÃ§a login novamente.",-1)])])),C(X,{holerite:m(H),"user-name":m(r)?.nome||"","user-cargo":m(r)?.cargo||"","user-departamento":m(r)?.departamento||"",onClose:o[3]||(o[3]=s=>H.value=null),onDownload:P},null,8,["holerite","user-name","user-cargo","user-departamento"])])}}});export{Ue as default};
